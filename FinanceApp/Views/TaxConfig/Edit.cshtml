@model FinanceApp.Models.dbTaxConfig

@{
    ViewData["Title"] = "Edit Tax Setting";
}

<div class="row justify-content-center">
    <div class="col-md-8">

        <form asp-action="Edit" id="formedit">
            @Html.HiddenFor(m => m.id) <!-- Hidden ID for Edit -->

            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3">
                    <h5 class="m-0 font-weight-bold text-primary"><i class="fas fa-edit mr-2"></i>Edit Tax Setting</h5>
                </div>
                <div class="card-body">
                    <!-- ... All form fields are identical to the Create page ... -->
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label class="font-weight-bold text-dark small text-uppercase">Tax Type</label>
                            @Html.DropDownListFor(m => m.taxtype, new List<SelectListItem> { new SelectListItem("final", "final"), new SelectListItem("non-final", "non-final") }, new { @class = "form-control" })
                            <span asp-validation-for="taxtype" class="text-danger small"></span>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="font-weight-bold text-dark small text-uppercase">Tax Mode</label>
                            @Html.DropDownListFor(m => m.taxmode, new List<SelectListItem> { new SelectListItem("fixed", "fixed"), new SelectListItem("range", "range") }, new { @class = "form-control", id = "taxModeDropdown" })
                            <span asp-validation-for="taxmode" class="text-danger small"></span>
                        </div>
                    </div>
                    <hr />
                    <div id="fixedLimitSection" style="display: none;">
                        <div class="form-group"><label class="font-weight-bold text-dark small text-uppercase">Tax Limit</label><input asp-for="taxlimit" class="form-control" /><span asp-validation-for="taxlimit" class="text-danger small"></span></div>
                    </div>
                    <div id="rangeLimitSection" style="display: none;">
                        <div class="form-row">
                            <div class="form-group col-md-6"><label class="font-weight-bold text-dark small text-uppercase">Tax Limit Minimum</label><input asp-for="taxlimitmin" class="form-control" /><span asp-validation-for="taxlimitmin" class="text-danger small"></span></div>
                            <div class="form-group col-md-6"><label class="font-weight-bold text-dark small text-uppercase">Tax Limit Maximum</label><input asp-for="taxlimitmax" class="form-control" /><span asp-validation-for="taxlimitmax" class="text-danger small"></span></div>
                        </div>
                        <small id="rangeError" class="text-danger" style="display:none;">Minimum limit cannot be greater than maximum limit.</small>
                    </div>
                    <hr />
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label class="font-weight-bold text-dark small text-uppercase">Tax Percentage</label>
                            <div class="input-group"><input asp-for="taxpercentage" class="form-control" /><div class="input-group-append"><span class="input-group-text">%</span></div></div>
                            <span asp-validation-for="taxpercentage" class="text-danger small"></span>
                        </div>
                        
                    </div>
                </div>

                <!-- Card Footer -->
                <div class="card-footer bg-white d-flex justify-content-between py-3">
                    <a asp-action="Index" class="btn btn-outline-secondary"><i class="fas fa-arrow-left mr-1"></i> Back to List</a>
                    <button type="submit" class="btn btn-primary px-4 shadow-sm"><i class="fas fa-save mr-1"></i> Update Setting</button>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <!-- The JavaScript is identical to the Create page -->
    <script>
        $(document).ready(function () {
            function toggleLimitFields() {
                var selectedMode = $('#taxModeDropdown').val();
                if (selectedMode === 'fixed') { $('#fixedLimitSection').show(); $('#rangeLimitSection').hide(); }
                else if (selectedMode === 'range') { $('#fixedLimitSection').hide(); $('#rangeLimitSection').show(); }
                else { $('#fixedLimitSection').hide(); $('#rangeLimitSection').hide(); }
            }
            function validateRange() {
                var min = parseInt($('input[name="taxlimitmin"]').val());
                var max = parseInt($('input[name="taxlimitmax"]').val());
                if (!isNaN(min) && !isNaN(max) && min > max) { $('#rangeError').show(); return false; }
                else { $('#rangeError').hide(); return true; }
            }
            $('#taxModeDropdown').on('change', toggleLimitFields);
            $('input[name="taxlimitmin"], input[name="taxlimitmax"]').on('blur', validateRange);
            $('#formedit').on('submit', function(e) {
                if ($('#taxModeDropdown').val() === 'range' && !validateRange()) { e.preventDefault(); alert('Please correct the range values.'); }
            });
            toggleLimitFields(); // Initial call
        });
    </script>
}